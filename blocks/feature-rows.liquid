
{% liquid
  assign rows = closest.product.metafields.custom.feature_row.value
  assign selected_category = block.settings.category | downcase | strip

  assign filter_enabled = true
  if selected_category == '' or selected_category == 'all'
    assign filter_enabled = false
  endif
%}

{% if rows != blank %}
  <div class="FeatureTable">
    {%- for r in rows -%}
      {%- liquid
        assign row_category = ''
        if r.category != blank
          assign row_category = r.category
        elsif r.section != blank
          assign row_category = r.section
        elsif r.group != blank
          assign row_category = r.group
        elsif r.type != blank
          assign row_category = r.type
        elsif r.title != blank
          assign row_category = r.title
        elsif r.name != blank
          assign row_category = r.name
        endif

        assign row_category = row_category | downcase | strip
      -%}

      {%- if filter_enabled == false or row_category == selected_category -%}
        {%- liquid
          assign row_icon = r.icon | default: r.image | default: r.icon_file
          assign row_title = r.title | default: r.heading | default: r.name
          assign row_body = r.body | default: r.text | default: r.description
        -%}
        <div class="FeatureRow">
          {%- if row_icon != blank -%}
            <img class="FeatureIcon" src="{{ row_icon | image_url: width: 64 }}" width="40" height="40" alt="{{ row_title | escape }}">
          {%- endif -%}
          <div class="FeatureText">
            {%- if row_title != blank -%}
              <div class="FeatureTitle">{{ row_title }}</div>
            {%- endif -%}
            {%- if row_body != blank -%}
              <div class="FeatureBody">{{ row_body | metafield_tag }}</div>
            {%- endif -%}
          </div>
        </div>
      {%- endif -%}
    {%- endfor -%}
  </div>
{% endif %}

{% stylesheet %}
  .FeatureTable {
    display: grid;
    gap: 16px;
  }

  .FeatureRow {
    display: grid;
    grid-template-columns: 48px 1fr;
    gap: 12px;
    align-items: start;
  }

  .FeatureIcon {
    width: 40px;
    height: 40px;
    object-fit: contain;
  }

  .FeatureTitle {
    font-weight: 600;
    margin-bottom: 4px;
  }

  .FeatureBody {
    color: var(--color-foreground-secondary, #5f6b7a);
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Feature rows",
  "tag": null,
  "settings": [
    {
      "type": "select",
      "id": "category",
      "label": "Category (optional)",
      "options": [
        { "value": "All", "label": "All" },
        { "value": "Ingredients", "label": "Ingredients" },
        { "value": "Benefits", "label": "Benefits" },
        { "value": "Usage", "label": "Usage" }
      ],
      "default": "All"
    }
  ]
}
{% endschema %}



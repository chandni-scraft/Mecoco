{{ 'video-reels-pure.css' | asset_url | stylesheet_tag }}
<script src="{{ 'video-reels-smooth.js' | asset_url }}" defer="defer"></script>

{%- liquid
  assign section_id = 'video-reels-stack-' | append: section.id
  assign reel_count = section.blocks.size
-%}

{%- liquid
  assign has_bg_image = false
  if section.settings.background_image != blank
    assign has_bg_image = true
  endif
-%}
<style>
  #{{ section_id }} {
    position: relative;
    overflow: hidden;
    padding: 60px 20px;
    text-align: center;
  }

  /* ✅ Fix: ensure heading is visible above overlay */
  #{{ section_id }} .video-reels-heading-wrapper {
    position: relative;
    z-index: 3; /* sits above overlay and videos */
    max-width: 800px;
    margin: 0 auto 40px auto;
  }

  /* optional: if you have dark overlay, make text bright */
  #{{ section_id }} .video-reels-heading {
    font-size: 2.5rem;
    font-weight: 700;
    color: {{ section.settings.heading_color | default: '#ffffff' }};
    margin-bottom: 10px;
    line-height: 1.3;
  }

  #{{ section_id }} .video-reels-subheading {
    font-size: 1.1rem;
    color: {{ section.settings.subheading_color | default: '#f0f0f0' }};
    opacity: 0.9;
    line-height: 1.6;
  }

  /* ✅ Make sure overlay is below content */
  #{{ section_id }} .background-overlay {
    z-index: 1;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  #{{ section_id }} .video-reels-stack-container {
    position: relative;
    z-index: 2;
  }

  @media (max-width: 768px) {
    #{{ section_id }} {
      padding: 40px 16px;
    }
    #{{ section_id }} .video-reels-heading {
      font-size: 1.8rem;
    }
    #{{ section_id }} .video-reels-subheading {
      font-size: 1rem;
    }
  }
</style>
<section id="{{ section_id }}" class="video-reels-stack-section {% if section.settings.full_width_background %}full-width-bg{% endif %}" data-section-id="{{ section.id }}" data-autoplay="{{ section.settings.autoplay }}" data-autoplay-speed="{{ section.settings.autoplay_speed }}">
  {%- if has_bg_image -%}
    <div class="video-reels-background-image {% if section.settings.background_blur %}blur-background{% endif %}">
      {%- capture bg_style -%}object-position: {{ section.settings.background_position }};{%- endcapture -%}
      {{ section.settings.background_image | image_url: width: 3840 | image_tag: loading: 'lazy', class: 'background-image', style: bg_style }}
      {%- if section.settings.background_overlay -%}
        <div class="background-overlay" style="opacity: {{ section.settings.overlay_opacity | divided_by: 100.0 }}; background-color: {{ section.settings.overlay_color }};"></div>
      {%- endif -%}
    </div>
  {%- endif -%}
   <!-- ✨ Centered Heading and Subheading 
  <div class="video-reels-heading-wrapper">
    
      <h2 class="video-reels-heading">Watch Our Reels </h2>
   
      <p class="video-reels-subheading">Follow us on Instagram </p>
  </div>-->
  <div class="video-reels-stack-container {% if section.settings.full_width_background %}full-width-container{% endif %}">
    <div class="video-reels-split-layout">
      {%- comment -%} Left side - Fixed content {%- endcomment -%}
      {%- comment -%} Right side - Scrolling videos {%- endcomment -%}
      <div class="video-reels-right-scroll">
        <button class="video-reels-nav video-reels-nav-prev" type="button" aria-label="Previous reel">
          <span class="video-reels-nav-icon">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M12.5 4.5L7 10l5.5 5.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
        </button>
        <button class="video-reels-nav video-reels-nav-next" type="button" aria-label="Next reel">
          <span class="video-reels-nav-icon">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M7.5 4.5L13 10l-5.5 5.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
        </button>
        <div class="video-reels-stack-wrapper">
          <div class="video-reels-stack" data-reel-count="{{ reel_count }}">
        {%- for block in section.blocks -%}
          <div class="video-reel-stack-card" data-reel-index="{{ forloop.index0 }}" data-active="{% if forloop.first %}true{% else %}false{% endif %}" {{ block.shopify_attributes }}>
            <div class="video-reel-stack-inner">
              <div class="video-reel-stack-media">
                {%- if block.settings.video != blank -%}
                  <video 
                    class="reel-stack-video"
                    playsinline
                    muted
                    loop
                    {% if forloop.first %}autoplay{% endif %}
                    preload="auto"
                    poster="{{ block.settings.video.preview_image | image_url: width: 720 }}"
                  >
                    {%- for source in block.settings.video.sources -%}
                      <source src="{{ source.url }}" type="{{ source.mime_type }}">
                    {%- endfor -%}
                  </video>
                {%- elsif block.settings.video_url != blank -%}
                  <div class="reel-stack-video-embed" data-video-url="{{ block.settings.video_url }}">
                    <iframe
                      src="{{ block.settings.video_url }}"
                      class="reel-stack-video"
                      frameborder="0"
                      allow="autoplay; encrypted-media"
                      allowfullscreen
                    ></iframe>
                  </div>
                {%- else -%}
                  <div class="reel-stack-placeholder">
                    <p>Add a video to showcase your products</p>
                  </div>
                {%- endif -%}
                
                <div class="video-progress-bar">
                  <div class="video-progress-fill"></div>
                </div>
              </div>
              
              <div class="video-reel-stack-overlay">
                <div class="video-reel-stack-content">
                  {%- if block.settings.caption != blank -%}
                    <div class="reel-stack-caption">
                      <h3>{{ block.settings.caption }}</h3>
                    </div>
                  {%- endif -%}
                  
                  {%- if block.settings.show_product_tag and block.settings.tagged_product != blank -%}
                    {%- assign product = block.settings.tagged_product -%}
                    <div class="reel-product-hotspot" style="left: {{ block.settings.tag_position_x }}%; top: {{ block.settings.tag_position_y }}%;">
                      <div class="hotspot-wrapper">
                        <div class="hotspot-pulse">
                          <span class="pulse-dot"></span>
                          <span class="pulse-ring"></span>
                          <span class="pulse-ring pulse-ring-2"></span>
                        </div>
                        
                        <button class="hotspot-trigger" aria-label="View {{ product.title }}">
                          <span class="hotspot-icon">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                              <path d="M10 5V15M5 10H15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                          </span>
                        </button>
                        
                        <div class="product-showcase">
                          <div class="showcase-arrow"></div>
                          <div class="showcase-content">
                            {%- if product.featured_image -%}
                              <div class="showcase-image">
                                {{ product.featured_image | image_url: width: 240 | image_tag: loading: 'lazy', alt: product.title }}
                                <div class="image-shimmer"></div>
                              </div>
                            {%- endif -%}
                            
                            <div class="showcase-details">
                              <span class="showcase-badge">Featured Product</span>
                              <h4 class="showcase-title">{{ product.title }}</h4>
                              <div class="showcase-price">
                                <span class="price-current">{{ product.price | money }}</span>
                                {%- if product.compare_at_price > product.price -%}
                                  <span class="price-compare">{{ product.compare_at_price | money }}</span>
                                  <span class="price-save">Save {{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price }}%</span>
                                {%- endif -%}
                              </div>
                              
                              <a href="{{ product.url }}" class="showcase-button">
                                <span>Discover More</span>
                                <svg width="16" height="16" viewBox="0 0 16 16">
                                  <path d="M3 8H13M10 5L13 8L10 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                              </a>
                              
                              <div class="showcase-quick-add">
                                <form action="/cart/add" method="post" enctype="multipart/form-data">
                                  <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                                  <button type="submit" class="quick-add-btn">
                                    <svg width="16" height="16" viewBox="0 0 16 16">
                                      <path d="M3 3H4L5 11H11L12 3H13M6 14C6 14.5 5.5 15 5 15C4.5 15 4 14.5 4 14C4 13.5 4.5 13 5 13C5.5 13 6 13.5 6 14ZM12 14C12 14.5 11.5 15 11 15C10.5 15 10 14.5 10 14C10 13.5 10.5 13 11 13C11.5 13 12 13.5 12 14Z" stroke="currentColor" fill="none"/>
                                    </svg>
                                    Quick Add
                                  </button>
                                </form>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  {%- endif -%}
                </div>
                
                <div class="video-reel-stack-actions">
                  <button class="reel-action-button reel-sound" aria-label="Toggle sound">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="sound-on">
                      <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" fill="currentColor"/>
                    </svg>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="sound-off" style="display:none;">
                      <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z" fill="currentColor"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        {%- endfor -%}
      </div>
      
      <div class="video-reels-progress">
        <div class="progress-line">
          <div class="progress-fill"></div>
        </div>
      </div>
    </div>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Video Reels Stack",
  "tag": "section",
  "class": "section-video-reels-stack",
  "max_blocks": 8,
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop The Look"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Discover our products in action"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Experience the essence of luxury with our exclusive collection. Each fragrance tells a unique story.</p>"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button label",
      "default": "Shop Collection"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-advance reels",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 5,
      "max": 15,
      "step": 1,
      "unit": "sec",
      "label": "Change reels every",
      "default": 8
    },
    {
      "type": "header",
      "content": "Background"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background image",
      "info": "Recommended: 3840 x 800px for full width"
    },
    {
      "type": "checkbox",
      "id": "full_width_background",
      "label": "Full width background",
      "default": false,
      "info": "Extend background to full browser width"
    },
    {
      "type": "checkbox",
      "id": "background_overlay",
      "label": "Add overlay",
      "default": true,
      "info": "Adds a color overlay to improve text visibility"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Overlay color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "%",
      "label": "Overlay opacity",
      "default": 30
    },
    {
      "type": "select",
      "id": "background_position",
      "label": "Background position",
      "options": [
        {
          "value": "top left",
          "label": "Top left"
        },
        {
          "value": "top center",
          "label": "Top center"
        },
        {
          "value": "top right",
          "label": "Top right"
        },
        {
          "value": "center left",
          "label": "Center left"
        },
        {
          "value": "center center",
          "label": "Center"
        },
        {
          "value": "center right",
          "label": "Center right"
        },
        {
          "value": "bottom left",
          "label": "Bottom left"
        },
        {
          "value": "bottom center",
          "label": "Bottom center"
        },
        {
          "value": "bottom right",
          "label": "Bottom right"
        }
      ],
      "default": "center center"
    },
    {
      "type": "checkbox",
      "id": "background_blur",
      "label": "Blur background",
      "default": false,
      "info": "Adds a subtle blur effect to the background image"
    }
  ],
  "blocks": [
    {
      "type": "video_reel",
      "name": "Video Reel",
      "settings": [
        {
          "type": "video",
          "id": "video",
          "label": "Video",
          "info": "Upload a video (9:16 aspect ratio recommended)"
        },
        {
          "type": "text",
          "id": "video_url",
          "label": "Or video URL",
          "info": "YouTube or Vimeo URL (if no video uploaded)"
        },
        {
          "type": "text",
          "id": "caption",
          "label": "Caption",
          "default": "Featured Product"
        },
        {
          "type": "checkbox",
          "id": "show_product_tag",
          "label": "Show product tag",
          "default": true
        },
        {
          "type": "product",
          "id": "tagged_product",
          "label": "Tagged product"
        },
        {
          "type": "range",
          "id": "tag_position_x",
          "min": 10,
          "max": 90,
          "step": 5,
          "unit": "%",
          "label": "Tag horizontal position",
          "default": 50
        },
        {
          "type": "range",
          "id": "tag_position_y",
          "min": 10,
          "max": 90,
          "step": 5,
          "unit": "%",
          "label": "Tag vertical position",
          "default": 70
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Video Reels Stack",
      "blocks": [
        {
          "type": "video_reel"
        },
        {
          "type": "video_reel"
        },
        {
          "type": "video_reel"
        }
      ]
    }
  ]
}
{% endschema %}


{% comment %} {{ 'video-reels-pure.css' | asset_url | stylesheet_tag }}
<script src="{{ 'video-reels-smooth.js' | asset_url }}" defer="defer"></script>

{%- liquid
  assign section_id = 'video-reels-stack-' | append: section.id
  assign reel_count = section.blocks.size
  assign has_bg_image = false
  if section.settings.background_image != blank
    assign has_bg_image = true
  endif
-%}
<style>
  #{{ section_id }} {
    position: relative;
    overflow: hidden;
    padding: 60px 20px;
    text-align: center;
  }

  /* ✅ Fix: ensure heading is visible above overlay */
  #{{ section_id }} .video-reels-heading-wrapper {
    position: relative;
    z-index: 3; /* sits above overlay and videos */
    max-width: 800px;
    margin: 0 auto 40px auto;
  }

  /* optional: if you have dark overlay, make text bright */
  #{{ section_id }} .video-reels-heading {
    font-size: 2.5rem;
    font-weight: 700;
    color: {{ section.settings.heading_color | default: '#ffffff' }};
    margin-bottom: 10px;
    line-height: 1.3;
  }

  #{{ section_id }} .video-reels-subheading {
    font-size: 1.1rem;
    color: {{ section.settings.subheading_color | default: '#f0f0f0' }};
    opacity: 0.9;
    line-height: 1.6;
  }

  /* ✅ Make sure overlay is below content */
  #{{ section_id }} .background-overlay {
    z-index: 1;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  #{{ section_id }} .video-reels-stack-container {
    position: relative;
    z-index: 2;
  }

  @media (max-width: 768px) {
    #{{ section_id }} {
      padding: 40px 16px;
    }
    #{{ section_id }} .video-reels-heading {
      font-size: 1.8rem;
    }
    #{{ section_id }} .video-reels-subheading {
      font-size: 1rem;
    }
  }
</style>


<section id="{{ section_id }}" 
  class="video-reels-stack-section {% if section.settings.full_width_background %}full-width-bg{% endif %}"
  data-section-id="{{ section.id }}"
  data-autoplay="{{ section.settings.autoplay }}"
  data-autoplay-speed="{{ section.settings.autoplay_speed }}"
>
  {%- if has_bg_image -%}
    <div class="video-reels-background-image {% if section.settings.background_blur %}blur-background{% endif %}">
      {%- capture bg_style -%}object-position: {{ section.settings.background_position }};{%- endcapture -%}
      {{ section.settings.background_image | image_url: width: 3840 | image_tag: loading: 'lazy', class: 'background-image', style: bg_style }}
      {%- if section.settings.background_overlay -%}
        <div class="background-overlay" style="opacity: {{ section.settings.overlay_opacity | divided_by: 100.0 }}; background-color: {{ section.settings.overlay_color }};"></div>
      {%- endif -%}
    </div>
  {%- endif -%}

  <!-- ✨ Centered Heading and Subheading -->
  <div class="video-reels-heading-wrapper">
    {%- if section.settings.main_heading != blank -%}
      <h2 class="video-reels-heading">{{ section.settings.main_heading }}</h2>
    {%- endif -%}
    {%- if section.settings.main_subheading != blank -%}
      <p class="video-reels-subheading">{{ section.settings.main_subheading }}</p>
    {%- endif -%}
  </div>

  <!-- Original Video Reels Stack -->
  <div class="video-reels-stack-container {% if section.settings.full_width_background %}full-width-container{% endif %}">
    <div class="video-reels-split-layout">
      <div class="video-reels-right-scroll">
        <div class="video-reels-stack-wrapper">
          <div class="video-reels-stack" data-reel-count="{{ reel_count }}">
            {%- for block in section.blocks -%}
              <div class="video-reel-stack-card" data-reel-index="{{ forloop.index0 }}" data-active="{% if forloop.first %}true{% else %}false{% endif %}" {{ block.shopify_attributes }}>
                <div class="video-reel-stack-inner">
                  <div class="video-reel-stack-media">
                    {%- if block.settings.video != blank -%}
                      <video 
                        class="reel-stack-video"
                        playsinline
                        muted
                        loop
                        {% if forloop.first %}autoplay{% endif %}
                        preload="auto"
                        poster="{{ block.settings.video.preview_image | image_url: width: 720 }}"
                      >
                        {%- for source in block.settings.video.sources -%}
                          <source src="{{ source.url }}" type="{{ source.mime_type }}">
                        {%- endfor -%}
                      </video>
                    {%- elsif block.settings.video_url != blank -%}
                      <div class="reel-stack-video-embed" data-video-url="{{ block.settings.video_url }}">
                        <iframe
                          src="{{ block.settings.video_url }}"
                          class="reel-stack-video"
                          frameborder="0"
                          allow="autoplay; encrypted-media"
                          allowfullscreen
                        ></iframe>
                      </div>
                    {%- else -%}
                      <div class="reel-stack-placeholder">
                        <p>Add a video to showcase your products</p>
                      </div>
                    {%- endif -%}
                    <div class="video-progress-bar">
                      <div class="video-progress-fill"></div>
                    </div>
                  </div>

                  <div class="video-reel-stack-overlay">
                    <div class="video-reel-stack-content">
                      {%- if block.settings.caption != blank -%}
                        <div class="reel-stack-caption">
                          <h3>{{ block.settings.caption }}</h3>
                        </div>
                      {%- endif -%}
                    </div>
                  </div>
                </div>
              </div>
            {%- endfor -%}
          </div>
        </div>
        <div class="video-reels-progress">
          <div class="progress-line"><div class="progress-fill"></div></div>
        </div>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Video Reels Stack",
  "tag": "section",
  "class": "section-video-reels-stack",
  "max_blocks": 8,
  "settings": [
    {
      "type": "header",
      "content": "Main Section Heading"
    },
    {
      "type": "text",
      "id": "main_heading",
      "label": "Main Heading",
      "default": "Watch Our Reels"
    },
    {
      "type": "text",
      "id": "main_subheading",
      "label": "Subheading",
      "default": "Experience our collection in motion"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#111111"
    },
    {
      "type": "color",
      "id": "subheading_color",
      "label": "Subheading Color",
      "default": "#555555"
    },
    {
      "type": "header",
      "content": "Video Settings"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-advance reels",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 5,
      "max": 15,
      "step": 1,
      "unit": "sec",
      "label": "Change reels every",
      "default": 8
    },
    {
      "type": "header",
      "content": "Background"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background image",
      "info": "Recommended: 3840 x 800px"
    },
    {
      "type": "checkbox",
      "id": "full_width_background",
      "label": "Full width background",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "background_overlay",
      "label": "Add overlay",
      "default": true
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Overlay color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "%",
      "label": "Overlay opacity",
      "default": 30
    },
    {
      "type": "select",
      "id": "background_position",
      "label": "Background position",
      "default": "center center",
      "options": [
        { "value": "top left", "label": "Top left" },
        { "value": "top center", "label": "Top center" },
        { "value": "top right", "label": "Top right" },
        { "value": "center left", "label": "Center left" },
        { "value": "center center", "label": "Center" },
        { "value": "center right", "label": "Center right" },
        { "value": "bottom left", "label": "Bottom left" },
        { "value": "bottom center", "label": "Bottom center" },
        { "value": "bottom right", "label": "Bottom right" }
      ]
    },
    {
      "type": "checkbox",
      "id": "background_blur",
      "label": "Blur background",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "video_reel",
      "name": "Video Reel",
      "settings": [
        { "type": "video", "id": "video", "label": "Video" },
        { "type": "text", "id": "video_url", "label": "Or video URL" },
        { "type": "text", "id": "caption", "label": "Caption" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Video Reels Stack",
      "blocks": [{ "type": "video_reel" }, { "type": "video_reel" }]
    }
  ]
}
{% endschema %} {% endcomment %}
